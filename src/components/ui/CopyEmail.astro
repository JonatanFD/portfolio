---
import ClipboardSuccess from "./icons/clipboardsuccess.astro";

interface Props {
    email: string;
}

const { email } = Astro.props;
---

<span
    class="copy-email-container inline-flex items-center gap-2 px-2 py-1 text-xs font-medium rounded-md bg-zinc-800/80 text-zinc-300 border border-zinc-700/50 cursor-pointer hover:bg-zinc-800 hover:text-zinc-100 hover:border-zinc-600 transition-colors"
    data-email={email}
>
    <span class="copy-email-text">{email}</span>
    <span class="icon-success hidden">
        <ClipboardSuccess class="size-4 text-emerald-500" />
    </span>
</span>

<script>
    function initCopyEmail() {
        const containers = document.querySelectorAll(".copy-email-container");

        containers.forEach((container) => {
            const iconSuccess = container.querySelector(".icon-success");

            if (!iconSuccess) return;

            const email = (container as HTMLElement).dataset.email || "";

            const copyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(email);

                    // Show success icon
                    iconSuccess.classList.remove("hidden");

                    // Reset after 2 seconds
                    setTimeout(() => {
                        iconSuccess.classList.add("hidden");
                    }, 2000);
                } catch (err) {
                    console.error("Failed to copy email:", err);
                }
            };

            container.addEventListener("click", copyToClipboard);
        });
    }

    // Initialize on page load
    initCopyEmail();

    // Re-initialize on Astro page transitions (if using View Transitions)
    document.addEventListener("astro:page-load", initCopyEmail);
</script>
